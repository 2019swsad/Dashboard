# Software Design

## 技术选型
- 后端   
后端采用基于 Nodejs 的 Koa 作为主要的服务端框架,采用 Mongodb 作为数据库,其最重要的特点是十分明晰的模块化设计.基于中间件的工作方式能形成一种链式的处理过程,十分适合 Web 应用这种每个请求都有相同点,也存在不同点的请求,这样能拆分请求,流水线化处理.还有就是 mongodb 的非关系型数据库适合快速开发,而不用考虑到表格的问题.使用类 MySQL 的数据库需要考虑表格的设计,但是 mongodb 的不定类型就可以很好地适应迭代开发中对数据属性的增添,避免了迭代时需要对表格进行兼容处理.而且 mongodb 能直接读写 JSON 对象而不用进行翻译转换,这样也提高了代码的可读可维护性.而 Koa 这个后端框架虽然看起来有点简陋,但是其能兼容比较成熟的 Express 的部件,也能直接使用 Nodejs 的模块,就十分容易进行功能拓展. Koa 的最重要一点是明晰的处理流程,能让请求十分清楚地表现出来和进行级联地处理,其处理像堆栈一样,中间能插入许多符合标准的中间件,这就相当于一种"糖".而这种结构显著提高了其鲁棒性和可靠性

## 架构设计
- 后端  
后端架构采用比较成熟的Koa开发结构,采用一个完全API化的后端,因为所有前端的页面设计都是承载在微信小程序上,故后端不需要解决静态文件的推送,只需要处理各种逻辑的处理,如管理用户,管理订单,管理任务.  
这样的架构就能顺理成章地让某个逻辑的代码落到某个类的的 controller 中,而这个 controller 暴露出其路由,由上层的初始化层进行综合和启动,并插入一些中间件去处理.而 controller 中只包含了每个API所需要的逻辑处理函数,而部分不和API产生直接关联的函数或者中间件,如数据库的初始化,钱包的操作函数,验证请求的       Session 的中间件,这些都放在了对应的 helper 中,这样避免了逻辑混乱和导致非公开函数被恶意调用  
## 模块划分
我们把功能划分为:用户,钱包,任务,订单,头像,信息
- 用户:处理用户注册,登录,验证,存储用户信息
- 钱包:钱包分为用户钱包和任务钱包,其功能基本一样,主要有转账,充值,记录每笔交易信息
- 任务:用户发布任务,交由系统处理,等待人来完成其任务,故有任务的发布,发布后的人员处理,完成任务和对应的订单
- 订单:用户接收对应任务所产生的订单,订单中包含交易的信息,所以有订单的创建,订单修改,订单关闭,订单评价等功能
- 信息:对应的任务处理都会出发其信息钩子,产生信息,最终让对应用户接收信息
- 头像:处理头像的上传下载
## Object-oriented programming (OOP)
在OOP中最显著的就是将许多东西都对象化,特别是重要数据和复杂一点的数据,都采取了对象化,如:用户,订单,任务,钱包,转账等,都采用了JSON的对象来进行包装,包装后就能直接形成能读能写,也能继续修改,并且能直接和前端进行通讯.  
如在contorller/userController.js中的user对象设计能参考Joi的检查schema,可以看到每个对象都是需要包含5个必须的属性

